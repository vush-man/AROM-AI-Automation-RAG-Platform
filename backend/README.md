# AMD Slingshot Backend

Pure **Node.js + Express + SQLite** backend for a RAG (Retrieval-Augmented Generation) system. Embeddings are generated by `embedding.ipynb` and exported to SQLite for the backend to query.

## Architecture

```
┌──────────────────────────────────────────┐
│         Node.js Backend (Express)        │
│                                          │
│  Auth (JWT) → Query → Embed (Ollama)     │
│    → Cosine Similarity (SQLite)          │
│    → RAG Answer (Ollama Chat)            │
│    → Confidence Score → Response         │
└──────────────┬───────────────────────────┘
               │ reads from
┌──────────────▼───────────────────────────┐
│           SQLite Database                │
│                                          │
│  users · queries · query_results         │
│  document_chunks · embeddings            │
│  human_feedback                          │
└──────────────▲───────────────────────────┘
               │ exports to
┌──────────────┴───────────────────────────┐
│  embedding.ipynb (run separately)        │
│                                          │
│  Ollama (qwen3-embedding:4b)             │
│  UnstructuredLoader → Chunking → FAISS   │
│  export_to_sqlite.py → SQLite            │
└──────────────────────────────────────────┘
```

## Structure

- **auth/** - JWT authentication middleware
- **db/** - SQLite database and schema
- **embeddings/** - Embedding notebook and export script
  - `embedding.ipynb` - Generates FAISS index from company files
  - `export_to_sqlite.py` - Exports FAISS data into SQLite
  - `embedder.js` - Calls Ollama for query-time embeddings
  - `docs/` - Place company files here (PDFs, DOCX, etc.)
- **retrieval/** - Cosine similarity search against SQLite
- **rag/** - Answer generation (Ollama chat) and confidence scoring
- **routes/** - API endpoints (auth, query, feedback)
- **utils/** - Logger and cosine similarity

## Setup

### 1. Install Node.js dependencies

```bash
npm install
```

### 2. Setup Ollama

```bash
# Install from https://ollama.com
ollama pull qwen3-embedding:4b
ollama pull qwen3:4b
```

### 3. Generate & Export Embeddings

1. Place company files in `embeddings/docs/`
2. Open `embeddings/embedding.ipynb` in Jupyter
3. Update `file_paths` with your file paths
4. Run all cells (creates `faiss_index/`)
5. Run the export script (in same Python env):
   ```bash
   python embeddings/export_to_sqlite.py
   ```
   Or add `%run export_to_sqlite.py` as a cell at the end of the notebook.

### 4. Start the backend

```bash
npm start
```

## API Endpoints

| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| POST | `/api/auth/signup` | No | Create account |
| POST | `/api/auth/login` | No | Login (returns JWT) |
| POST | `/api/query` | JWT | Submit a query |
| GET | `/api/query/history` | JWT | Get query history |
| POST | `/api/feedback` | JWT | Submit feedback |
| GET | `/api/feedback/stats` | JWT | Feedback statistics |
| GET | `/health` | No | Health check |
